/*
 * Click nbfs://nbhost/SystemFileSystem/Templates/Licenses/license-default.txt to change this license
 * Click nbfs://nbhost/SystemFileSystem/Templates/GUIForms/JFrame.java to edit this template
 */
package com.mycompany.quanltthuvien.View;

import com.mycompany.quanltthuvien.Model.KhachHang;
import com.mycompany.quanltthuvien.Model.Muon;
import com.mycompany.quanltthuvien.Model.Sach;
import com.mycompany.quanltthuvien.Controller.ManagerController;
import com.mycompany.quanltthuvien.Model.TaiKhoan;
import com.mycompany.quanltthuvien.Model.TheLoai;
import com.mycompany.quanltthuvien.Service.SachService;
import com.mycompany.quanltthuvien.Service.TaiKhoanService;

import java.awt.HeadlessException;

import java.io.IOException;
import java.lang.classfile.instruction.SwitchCase;
import java.lang.reflect.Array;
import java.sql.Date;
import java.time.LocalDate;

import javax.swing.JOptionPane;
import javax.swing.table.DefaultTableModel;

import java.util.ArrayList;
import java.util.logging.Level;
import java.util.logging.Logger;


/**
 *
 * @author hienb
 */
public class Manager extends javax.swing.JFrame {
    private javax.swing.JTabbedPane tabManager;
    ManagerController managerController = new ManagerController();
    SachService sachService = new SachService();
    
    String usernameLogin = "admin";
    /**
     * Creates new form NewJFrame
     */
    public Manager() {
        initComponents();
        setSize(1124, 768); // hoặc kích thước bạn muốn
        setLocationRelativeTo(null);

        loadTableKH(managerController.GetAllKhachHang());
        loadTableBanDoc();
        loadTableKhoSach();
    }
    
    TaiKhoan tk = new TaiKhoan("null ", "null", "null", "0912345678", "null");
    
    public void GetUsername(String usernameLogin) throws InterruptedException, IOException {
            TaiKhoanService taiKhoanService = new TaiKhoanService();
            tk = taiKhoanService.GetTaiKhoan(usernameLogin);
            Info_txtUsername.setText(tk.getUsername());
            Info_tstTen.setText(tk.getTenTK());
            Info_txtSDT.setText(tk.getSdtTK());
    }

    /**
     * This method is called from within the constructor to initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is always
     * regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        jTabbedPane1 = new javax.swing.JTabbedPane();
        jPanel1 = new javax.swing.JPanel();
        TimKiem = new javax.swing.JPanel();
        jScrollPane3 = new javax.swing.JScrollPane();
        TimKiem_tbDSKH = new javax.swing.JTable();
        TimKiem_cbGet = new javax.swing.JComboBox<>();
        TimKiem_btTim = new javax.swing.JButton();
        TimKiem_btMuon = new javax.swing.JButton();
        TimKiem_lbSDT = new javax.swing.JLabel();
        TimKiem_lbMaKH = new javax.swing.JLabel();
        TimKiem_lbTenKH = new javax.swing.JLabel();
        TimKiem_txtSDT = new javax.swing.JTextField();
        TimKiem_txtMaKH = new javax.swing.JTextField();
        TimKiem_txtTenKH = new javax.swing.JTextField();
        TimKiem_lbTimTheo = new javax.swing.JLabel();
        TimKiem_btHienThi = new javax.swing.JButton();
        Muon = new javax.swing.JPanel();
        jScrollPane1 = new javax.swing.JScrollPane();
        Muon_tbDSMuon = new javax.swing.JTable();
        jScrollPane2 = new javax.swing.JScrollPane();
        Muon_tbSach = new javax.swing.JTable();
        Muon_lbSLMuon = new javax.swing.JLabel();
        Muon_txtSLMuon = new javax.swing.JTextField();
        Muon_bt = new javax.swing.JButton();
        Muon_lbMaKH = new javax.swing.JLabel();
        Muon_txtMaKH = new javax.swing.JTextField();
        Muon_lbTenKH = new javax.swing.JLabel();
        Muon_txtTenKH = new javax.swing.JTextField();
        Muon_txtTenSach = new javax.swing.JTextField();
        Muon_lbTenSach = new javax.swing.JLabel();
        Muon_lbDSMuon = new javax.swing.JLabel();
        Muon_lbTheLoaiTimKiem = new javax.swing.JLabel();
        Muon_txtTheLoaiTimKiem = new javax.swing.JTextField();
        Muon_lbMaSachTimKiem = new javax.swing.JLabel();
        Muon_txtMaSachTimKiem = new javax.swing.JTextField();
        Muon_btTimKiemSach = new javax.swing.JButton();
        Muon_cbTimTheo = new javax.swing.JComboBox<>();
        Muon_lbTenSachTimKiem = new javax.swing.JLabel();
        Muon_txtTenSachTimKiem = new javax.swing.JTextField();
        Muon_lbSach = new javax.swing.JLabel();
        Muon_btXacNhan = new javax.swing.JButton();
        Muon_btConfimrMuon = new javax.swing.JButton();
        Muon_HuyMuon = new javax.swing.JButton();
        jButton2 = new javax.swing.JButton();
        TraSach = new javax.swing.JPanel();
        TraSach_lbSLTra = new javax.swing.JLabel();
        TraSach_txtSLTra = new javax.swing.JTextField();
        TraSach_bt = new javax.swing.JButton();
        TraSach_lbMaKH = new javax.swing.JLabel();
        TraSach_txtMaKH = new javax.swing.JTextField();
        TraSach_lbTenKH = new javax.swing.JLabel();
        TraSach_txtTenKH = new javax.swing.JTextField();
        TraSach_txtMaMuon = new javax.swing.JTextField();
        TraSach_lbTenSach = new javax.swing.JLabel();
        jScrollPane4 = new javax.swing.JScrollPane();
        TraSach_tbDSTra = new javax.swing.JTable();
        TraSach_lbDSTra = new javax.swing.JLabel();
        jScrollPane5 = new javax.swing.JScrollPane();
        TraSach_tbDSMuon = new javax.swing.JTable();
        TraSach_lbMaSach = new javax.swing.JLabel();
        TraSach_txtMaSachTimKiem = new javax.swing.JTextField();
        TraSach_btTimKiemSach = new javax.swing.JButton();
        Muon_lbTenSachTimKiem1 = new javax.swing.JLabel();
        TraSach_txtTenSachTimKiem = new javax.swing.JTextField();
        TraSach_lbDSMuon = new javax.swing.JLabel();
        TraSach_lbTheLoai = new javax.swing.JLabel();
        TraSach_txtTheLoaiTimKiem = new javax.swing.JTextField();
        TraSach_cbTimKiem = new javax.swing.JComboBox<>();
        TraSach_btXacNhan = new javax.swing.JButton();
        TraSach_btHienThi = new javax.swing.JButton();
        jButton3 = new javax.swing.JButton();
        jButton4 = new javax.swing.JButton();
        jButton5 = new javax.swing.JButton();
        TruyVan = new javax.swing.JPanel();
        jScrollPane6 = new javax.swing.JScrollPane();
        TruyVan_tbDonMuon = new javax.swing.JTable();
        TruyVan_bt = new javax.swing.JButton();
        TruyVan_lbQuaHan = new javax.swing.JButton();
        TruyVan_lbLayTT = new javax.swing.JButton();
        BanDoc = new javax.swing.JPanel();
        BanDoc_btSua = new javax.swing.JButton();
        BanDoc_txtMa = new javax.swing.JTextField();
        BanDoc_txtTenBanDoc = new javax.swing.JTextField();
        BanDoc_txtSDT = new javax.swing.JTextField();
        jScrollPane7 = new javax.swing.JScrollPane();
        BanDoc_tbBanDoc = new javax.swing.JTable();
        BanDoc_lbSDT = new javax.swing.JLabel();
        BanDoc_lbMa = new javax.swing.JLabel();
        BanDoc_lbTenBanDoc = new javax.swing.JLabel();
        BanDoc_btXoa = new javax.swing.JButton();
        BanDoc_btThem = new javax.swing.JButton();
        BanDoc_btXacNhan = new javax.swing.JButton();
        jButton1 = new javax.swing.JButton();
        jPanel3 = new javax.swing.JPanel();
        Info_lbTK = new javax.swing.JLabel();
        Info_txtUsername = new javax.swing.JTextField();
        Info_tstTen = new javax.swing.JTextField();
        info_lbTen = new javax.swing.JLabel();
        Info_txtSDT = new javax.swing.JTextField();
        info_lbSDT = new javax.swing.JLabel();
        Info_LogOut = new javax.swing.JButton();

        setDefaultCloseOperation(javax.swing.WindowConstants.EXIT_ON_CLOSE);

        jTabbedPane1.setMaximumSize(new java.awt.Dimension(1024, 768));
        jTabbedPane1.setMinimumSize(new java.awt.Dimension(1024, 768));
        jTabbedPane1.setPreferredSize(new java.awt.Dimension(1124, 768));

        TimKiem.setLayout(null);

        TimKiem_tbDSKH.setModel(new javax.swing.table.DefaultTableModel(
            new Object [][] {
                {null, null, null},
                {null, null, null},
                {null, null, null},
                {null, null, null}
            },
            new String [] {
                "Mã khách hàng", "Tên Khách hàng", "Số điện thoại"
            }
        ) {
            Class[] types = new Class [] {
                java.lang.String.class, java.lang.String.class, java.lang.String.class
            };

            public Class getColumnClass(int columnIndex) {
                return types [columnIndex];
            }
        });
        jScrollPane3.setViewportView(TimKiem_tbDSKH);

        TimKiem.add(jScrollPane3);
        jScrollPane3.setBounds(110, 310, 770, 350);

        TimKiem_cbGet.setFont(new java.awt.Font("Segoe UI", 0, 14)); // NOI18N
        TimKiem_cbGet.setModel(new javax.swing.DefaultComboBoxModel<>(new String[] { "Mã", "Tên Bạn đọc", "Số Điện thoại" }));
        TimKiem_cbGet.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                TimKiem_cbGetActionPerformed(evt);
            }
        });
        TimKiem.add(TimKiem_cbGet);
        TimKiem_cbGet.setBounds(650, 50, 120, 30);

        TimKiem_btTim.setFont(new java.awt.Font("Segoe UI", 0, 14)); // NOI18N
        TimKiem_btTim.setText("Tìm Kiếm");
        TimKiem_btTim.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                TimKiem_btTimActionPerformed(evt);
            }
        });
        TimKiem.add(TimKiem_btTim);
        TimKiem_btTim.setBounds(650, 130, 110, 40);

        TimKiem_btMuon.setFont(new java.awt.Font("Segoe UI", 0, 14)); // NOI18N
        TimKiem_btMuon.setText("Lấy thông tin");
        TimKiem_btMuon.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                TimKiem_btMuonActionPerformed(evt);
            }
        });
        TimKiem.add(TimKiem_btMuon);
        TimKiem_btMuon.setBounds(630, 240, 130, 50);

        TimKiem_lbSDT.setFont(new java.awt.Font("Segoe UI", 0, 14)); // NOI18N
        TimKiem_lbSDT.setText("Số điện thoại:");
        TimKiem.add(TimKiem_lbSDT);
        TimKiem_lbSDT.setBounds(160, 130, 110, 30);

        TimKiem_lbMaKH.setFont(new java.awt.Font("Segoe UI", 0, 14)); // NOI18N
        TimKiem_lbMaKH.setText("Mã:");
        TimKiem.add(TimKiem_lbMaKH);
        TimKiem_lbMaKH.setBounds(160, 50, 110, 30);

        TimKiem_lbTenKH.setFont(new java.awt.Font("Segoe UI", 0, 14)); // NOI18N
        TimKiem_lbTenKH.setText("Tên Bạn đọc:");
        TimKiem.add(TimKiem_lbTenKH);
        TimKiem_lbTenKH.setBounds(160, 90, 110, 30);

        TimKiem_txtSDT.setFont(new java.awt.Font("Segoe UI", 0, 14)); // NOI18N
        TimKiem_txtSDT.setEnabled(false);
        TimKiem.add(TimKiem_txtSDT);
        TimKiem_txtSDT.setBounds(290, 130, 210, 26);

        TimKiem_txtMaKH.setFont(new java.awt.Font("Segoe UI", 0, 14)); // NOI18N
        TimKiem.add(TimKiem_txtMaKH);
        TimKiem_txtMaKH.setBounds(290, 50, 210, 26);

        TimKiem_txtTenKH.setFont(new java.awt.Font("Segoe UI", 0, 14)); // NOI18N
        TimKiem_txtTenKH.setEnabled(false);
        TimKiem.add(TimKiem_txtTenKH);
        TimKiem_txtTenKH.setBounds(290, 90, 210, 26);

        TimKiem_lbTimTheo.setFont(new java.awt.Font("Segoe UI", 0, 14)); // NOI18N
        TimKiem_lbTimTheo.setText("Tìm theo:");
        TimKiem.add(TimKiem_lbTimTheo);
        TimKiem_lbTimTheo.setBounds(570, 60, 60, 20);

        TimKiem_btHienThi.setFont(new java.awt.Font("Segoe UI", 0, 18)); // NOI18N
        TimKiem_btHienThi.setText("Hiển thị");
        TimKiem_btHienThi.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                TimKiem_btHienThiActionPerformed(evt);
            }
        });
        TimKiem.add(TimKiem_btHienThi);
        TimKiem_btHienThi.setBounds(490, 240, 120, 50);

        javax.swing.GroupLayout jPanel1Layout = new javax.swing.GroupLayout(jPanel1);
        jPanel1.setLayout(jPanel1Layout);
        jPanel1Layout.setHorizontalGroup(
            jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, jPanel1Layout.createSequentialGroup()
                .addContainerGap()
                .addComponent(TimKiem, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                .addContainerGap())
        );
        jPanel1Layout.setVerticalGroup(
            jPanel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addComponent(TimKiem, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
        );

        jTabbedPane1.addTab("Tìm Kiếm", jPanel1);

        Muon.setLayout(null);

        Muon_tbDSMuon.setModel(new javax.swing.table.DefaultTableModel(
            new Object [][] {

            },
            new String [] {
                "Mã sách", "Tên sách", "Tác giả", "Số lượng mượn"
            }
        ) {
            Class[] types = new Class [] {
                java.lang.String.class, java.lang.String.class, java.lang.String.class, java.lang.Integer.class
            };

            public Class getColumnClass(int columnIndex) {
                return types [columnIndex];
            }
        });
        jScrollPane1.setViewportView(Muon_tbDSMuon);

        Muon.add(jScrollPane1);
        jScrollPane1.setBounds(40, 300, 410, 340);

        Muon_tbSach.setModel(new javax.swing.table.DefaultTableModel(
            new Object [][] {
                {null, null, null, null, null},
                {null, null, null, null, null},
                {null, null, null, null, null},
                {null, null, null, null, null}
            },
            new String [] {
                "Mã Sách", "Tên Sách", "Tác giả", "Thể loại", "Số lượng"
            }
        ) {
            Class[] types = new Class [] {
                java.lang.String.class, java.lang.String.class, java.lang.Object.class, java.lang.String.class, java.lang.Integer.class
            };

            public Class getColumnClass(int columnIndex) {
                return types [columnIndex];
            }
        });
        jScrollPane2.setViewportView(Muon_tbSach);

        Muon.add(jScrollPane2);
        jScrollPane2.setBounds(600, 310, 490, 350);

        Muon_lbSLMuon.setFont(new java.awt.Font("Segoe UI", 0, 14)); // NOI18N
        Muon_lbSLMuon.setText("Số lượng mượn:");
        Muon.add(Muon_lbSLMuon);
        Muon_lbSLMuon.setBounds(60, 170, 120, 30);

        Muon_txtSLMuon.setFont(new java.awt.Font("Segoe UI", 0, 14)); // NOI18N
        Muon.add(Muon_txtSLMuon);
        Muon_txtSLMuon.setBounds(180, 170, 221, 26);

        Muon_bt.setFont(new java.awt.Font("Segoe UI", 0, 14)); // NOI18N
        Muon_bt.setText("Mượn");
        Muon_bt.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                Muon_btActionPerformed(evt);
            }
        });
        Muon.add(Muon_bt);
        Muon_bt.setBounds(420, 110, 90, 27);

        Muon_lbMaKH.setFont(new java.awt.Font("Segoe UI", 0, 14)); // NOI18N
        Muon_lbMaKH.setText("Mã bạn đọc:");
        Muon.add(Muon_lbMaKH);
        Muon_lbMaKH.setBounds(60, 50, 120, 30);

        Muon_txtMaKH.setFont(new java.awt.Font("Segoe UI", 0, 14)); // NOI18N
        Muon_txtMaKH.setEnabled(false);
        Muon.add(Muon_txtMaKH);
        Muon_txtMaKH.setBounds(180, 50, 221, 26);

        Muon_lbTenKH.setFont(new java.awt.Font("Segoe UI", 0, 14)); // NOI18N
        Muon_lbTenKH.setText("Tên bạn đọc: ");
        Muon.add(Muon_lbTenKH);
        Muon_lbTenKH.setBounds(60, 90, 120, 30);

        Muon_txtTenKH.setFont(new java.awt.Font("Segoe UI", 0, 14)); // NOI18N
        Muon_txtTenKH.setEnabled(false);
        Muon.add(Muon_txtTenKH);
        Muon_txtTenKH.setBounds(180, 90, 221, 26);

        Muon_txtTenSach.setFont(new java.awt.Font("Segoe UI", 0, 14)); // NOI18N
        Muon_txtTenSach.setEnabled(false);
        Muon.add(Muon_txtTenSach);
        Muon_txtTenSach.setBounds(180, 130, 221, 26);

        Muon_lbTenSach.setFont(new java.awt.Font("Segoe UI", 0, 14)); // NOI18N
        Muon_lbTenSach.setText("Tên sách:");
        Muon.add(Muon_lbTenSach);
        Muon_lbTenSach.setBounds(60, 130, 120, 30);

        Muon_lbDSMuon.setFont(new java.awt.Font("Segoe UI", 0, 18)); // NOI18N
        Muon_lbDSMuon.setText("Danh sách Mượn");
        Muon.add(Muon_lbDSMuon);
        Muon_lbDSMuon.setBounds(40, 250, 140, 30);

        Muon_lbTheLoaiTimKiem.setFont(new java.awt.Font("Segoe UI", 0, 14)); // NOI18N
        Muon_lbTheLoaiTimKiem.setText("Thể loại:");
        Muon.add(Muon_lbTheLoaiTimKiem);
        Muon_lbTheLoaiTimKiem.setBounds(640, 130, 70, 30);

        Muon_txtTheLoaiTimKiem.setFont(new java.awt.Font("Segoe UI", 0, 14)); // NOI18N
        Muon_txtTheLoaiTimKiem.setEnabled(false);
        Muon.add(Muon_txtTheLoaiTimKiem);
        Muon_txtTheLoaiTimKiem.setBounds(720, 130, 180, 26);

        Muon_lbMaSachTimKiem.setFont(new java.awt.Font("Segoe UI", 0, 14)); // NOI18N
        Muon_lbMaSachTimKiem.setText("Mã sách:");
        Muon.add(Muon_lbMaSachTimKiem);
        Muon_lbMaSachTimKiem.setBounds(640, 50, 70, 30);

        Muon_txtMaSachTimKiem.setFont(new java.awt.Font("Segoe UI", 0, 14)); // NOI18N
        Muon.add(Muon_txtMaSachTimKiem);
        Muon_txtMaSachTimKiem.setBounds(720, 50, 180, 26);

        Muon_btTimKiemSach.setText("Tìm Kiếm Sách");
        Muon_btTimKiemSach.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                Muon_btTimKiemSachActionPerformed(evt);
            }
        });
        Muon.add(Muon_btTimKiemSach);
        Muon_btTimKiemSach.setBounds(750, 180, 110, 30);

        Muon_cbTimTheo.setFont(new java.awt.Font("Segoe UI", 0, 14)); // NOI18N
        Muon_cbTimTheo.setModel(new javax.swing.DefaultComboBoxModel<>(new String[] { "Mã Sách", "Tên Sách", "Thể Loại" }));
        Muon_cbTimTheo.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                Muon_cbTimTheoActionPerformed(evt);
            }
        });
        Muon.add(Muon_cbTimTheo);
        Muon_cbTimTheo.setBounds(950, 90, 100, 30);

        Muon_lbTenSachTimKiem.setFont(new java.awt.Font("Segoe UI", 0, 14)); // NOI18N
        Muon_lbTenSachTimKiem.setText("Tên sách:");
        Muon.add(Muon_lbTenSachTimKiem);
        Muon_lbTenSachTimKiem.setBounds(640, 90, 70, 30);

        Muon_txtTenSachTimKiem.setFont(new java.awt.Font("Segoe UI", 0, 14)); // NOI18N
        Muon_txtTenSachTimKiem.setEnabled(false);
        Muon.add(Muon_txtTenSachTimKiem);
        Muon_txtTenSachTimKiem.setBounds(720, 90, 180, 26);

        Muon_lbSach.setFont(new java.awt.Font("Segoe UI", 0, 18)); // NOI18N
        Muon_lbSach.setText("Kho Sách");
        Muon.add(Muon_lbSach);
        Muon_lbSach.setBounds(600, 260, 90, 25);

        Muon_btXacNhan.setFont(new java.awt.Font("Segoe UI", 0, 14)); // NOI18N
        Muon_btXacNhan.setText("Xác nhận");
        Muon_btXacNhan.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                Muon_btXacNhanActionPerformed(evt);
            }
        });
        Muon.add(Muon_btXacNhan);
        Muon_btXacNhan.setBounds(920, 260, 100, 30);

        Muon_btConfimrMuon.setText("Xác nhận mượn");
        Muon_btConfimrMuon.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                Muon_btConfimrMuonActionPerformed(evt);
            }
        });
        Muon.add(Muon_btConfimrMuon);
        Muon_btConfimrMuon.setBounds(330, 260, 130, 23);

        Muon_HuyMuon.setText("Hủy mượn");
        Muon_HuyMuon.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                Muon_HuyMuonActionPerformed(evt);
            }
        });
        Muon.add(Muon_HuyMuon);
        Muon_HuyMuon.setBounds(200, 260, 120, 23);

        jButton2.setFont(new java.awt.Font("Segoe UI", 0, 14)); // NOI18N
        jButton2.setText("Hiển thị");
        jButton2.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jButton2ActionPerformed(evt);
            }
        });
        Muon.add(jButton2);
        jButton2.setBounds(800, 260, 110, 30);

        jTabbedPane1.addTab("Mượn sách", Muon);

        TraSach.setLayout(null);

        TraSach_lbSLTra.setFont(new java.awt.Font("Segoe UI", 0, 14)); // NOI18N
        TraSach_lbSLTra.setText("Số lượng trả:");
        TraSach.add(TraSach_lbSLTra);
        TraSach_lbSLTra.setBounds(60, 170, 120, 30);

        TraSach_txtSLTra.setFont(new java.awt.Font("Segoe UI", 0, 14)); // NOI18N
        TraSach.add(TraSach_txtSLTra);
        TraSach_txtSLTra.setBounds(180, 170, 221, 26);

        TraSach_bt.setFont(new java.awt.Font("Segoe UI", 0, 14)); // NOI18N
        TraSach_bt.setText("Trả");
        TraSach_bt.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                TraSach_btActionPerformed(evt);
            }
        });
        TraSach.add(TraSach_bt);
        TraSach_bt.setBounds(430, 120, 80, 27);

        TraSach_lbMaKH.setFont(new java.awt.Font("Segoe UI", 0, 14)); // NOI18N
        TraSach_lbMaKH.setText("Mã bạn đọc:");
        TraSach.add(TraSach_lbMaKH);
        TraSach_lbMaKH.setBounds(60, 50, 120, 30);

        TraSach_txtMaKH.setFont(new java.awt.Font("Segoe UI", 0, 14)); // NOI18N
        TraSach_txtMaKH.setEnabled(false);
        TraSach.add(TraSach_txtMaKH);
        TraSach_txtMaKH.setBounds(180, 50, 221, 26);

        TraSach_lbTenKH.setFont(new java.awt.Font("Segoe UI", 0, 14)); // NOI18N
        TraSach_lbTenKH.setText("Tên bạn đọc: ");
        TraSach.add(TraSach_lbTenKH);
        TraSach_lbTenKH.setBounds(60, 90, 120, 30);

        TraSach_txtTenKH.setFont(new java.awt.Font("Segoe UI", 0, 14)); // NOI18N
        TraSach_txtTenKH.setEnabled(false);
        TraSach.add(TraSach_txtTenKH);
        TraSach_txtTenKH.setBounds(180, 90, 221, 26);

        TraSach_txtMaMuon.setFont(new java.awt.Font("Segoe UI", 0, 14)); // NOI18N
        TraSach_txtMaMuon.setEnabled(false);
        TraSach.add(TraSach_txtMaMuon);
        TraSach_txtMaMuon.setBounds(180, 130, 221, 26);

        TraSach_lbTenSach.setFont(new java.awt.Font("Segoe UI", 0, 14)); // NOI18N
        TraSach_lbTenSach.setText("Mã Mượn:");
        TraSach.add(TraSach_lbTenSach);
        TraSach_lbTenSach.setBounds(60, 130, 120, 30);

        TraSach_tbDSTra.setModel(new javax.swing.table.DefaultTableModel(
            new Object [][] {

            },
            new String [] {
                "Mã mượn", "Tên sách", "Số lượng trả"
            }
        ) {
            Class[] types = new Class [] {
                java.lang.String.class, java.lang.String.class, java.lang.Integer.class
            };

            public Class getColumnClass(int columnIndex) {
                return types [columnIndex];
            }
        });
        jScrollPane4.setViewportView(TraSach_tbDSTra);

        TraSach.add(jScrollPane4);
        jScrollPane4.setBounds(40, 300, 410, 360);

        TraSach_lbDSTra.setFont(new java.awt.Font("Segoe UI", 0, 18)); // NOI18N
        TraSach_lbDSTra.setText("Danh sách Trả");
        TraSach.add(TraSach_lbDSTra);
        TraSach_lbDSTra.setBounds(40, 250, 140, 30);

        TraSach_tbDSMuon.setModel(new javax.swing.table.DefaultTableModel(
            new Object [][] {

            },
            new String [] {
                "Mã mượn", "Tên Sách", "Số lượng", "Ngày mượn", "Ngày trả"
            }
        ) {
            Class[] types = new Class [] {
                java.lang.String.class, java.lang.String.class, java.lang.Integer.class, java.lang.String.class, java.lang.String.class
            };

            public Class getColumnClass(int columnIndex) {
                return types [columnIndex];
            }
        });
        jScrollPane5.setViewportView(TraSach_tbDSMuon);

        TraSach.add(jScrollPane5);
        jScrollPane5.setBounds(510, 310, 560, 350);

        TraSach_lbMaSach.setFont(new java.awt.Font("Segoe UI", 0, 14)); // NOI18N
        TraSach_lbMaSach.setText("Mã sách:");
        TraSach.add(TraSach_lbMaSach);
        TraSach_lbMaSach.setBounds(660, 50, 70, 30);

        TraSach_txtMaSachTimKiem.setFont(new java.awt.Font("Segoe UI", 0, 14)); // NOI18N
        TraSach.add(TraSach_txtMaSachTimKiem);
        TraSach_txtMaSachTimKiem.setBounds(750, 50, 180, 26);

        TraSach_btTimKiemSach.setText("Tìm Kiếm");
        TraSach_btTimKiemSach.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                TraSach_btTimKiemSachActionPerformed(evt);
            }
        });
        TraSach.add(TraSach_btTimKiemSach);
        TraSach_btTimKiemSach.setBounds(780, 230, 90, 30);

        Muon_lbTenSachTimKiem1.setFont(new java.awt.Font("Segoe UI", 0, 14)); // NOI18N
        Muon_lbTenSachTimKiem1.setText("Tên sách:");
        TraSach.add(Muon_lbTenSachTimKiem1);
        Muon_lbTenSachTimKiem1.setBounds(660, 90, 70, 30);

        TraSach_txtTenSachTimKiem.setFont(new java.awt.Font("Segoe UI", 0, 14)); // NOI18N
        TraSach_txtTenSachTimKiem.setEnabled(false);
        TraSach.add(TraSach_txtTenSachTimKiem);
        TraSach_txtTenSachTimKiem.setBounds(750, 90, 180, 26);

        TraSach_lbDSMuon.setFont(new java.awt.Font("Segoe UI", 0, 18)); // NOI18N
        TraSach_lbDSMuon.setText("Danh sách đang mượn");
        TraSach.add(TraSach_lbDSMuon);
        TraSach_lbDSMuon.setBounds(510, 270, 190, 25);

        TraSach_lbTheLoai.setFont(new java.awt.Font("Segoe UI", 0, 14)); // NOI18N
        TraSach_lbTheLoai.setText("Thể loại:");
        TraSach.add(TraSach_lbTheLoai);
        TraSach_lbTheLoai.setBounds(660, 130, 70, 30);

        TraSach_txtTheLoaiTimKiem.setFont(new java.awt.Font("Segoe UI", 0, 14)); // NOI18N
        TraSach_txtTheLoaiTimKiem.setEnabled(false);
        TraSach.add(TraSach_txtTheLoaiTimKiem);
        TraSach_txtTheLoaiTimKiem.setBounds(750, 130, 180, 26);

        TraSach_cbTimKiem.setFont(new java.awt.Font("Segoe UI", 0, 14)); // NOI18N
        TraSach_cbTimKiem.setModel(new javax.swing.DefaultComboBoxModel<>(new String[] { "Mã sách", "Tên sách", "Thể loại" }));
        TraSach_cbTimKiem.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                TraSach_cbTimKiemActionPerformed(evt);
            }
        });
        TraSach.add(TraSach_cbTimKiem);
        TraSach_cbTimKiem.setBounds(960, 110, 90, 26);

        TraSach_btXacNhan.setFont(new java.awt.Font("Segoe UI", 0, 14)); // NOI18N
        TraSach_btXacNhan.setText("Xác nhận");
        TraSach_btXacNhan.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                TraSach_btXacNhanActionPerformed(evt);
            }
        });
        TraSach.add(TraSach_btXacNhan);
        TraSach_btXacNhan.setBounds(980, 260, 90, 30);

        TraSach_btHienThi.setFont(new java.awt.Font("Segoe UI", 0, 14)); // NOI18N
        TraSach_btHienThi.setText("Hiển thị");
        TraSach_btHienThi.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                TraSach_btHienThiActionPerformed(evt);
            }
        });
        TraSach.add(TraSach_btHienThi);
        TraSach_btHienThi.setBounds(880, 260, 90, 30);

        jButton3.setText("Xác nhận trả");
        jButton3.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jButton3ActionPerformed(evt);
            }
        });
        TraSach.add(jButton3);
        jButton3.setBounds(330, 250, 100, 30);

        jButton4.setText("Hủy trả");
        jButton4.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jButton4ActionPerformed(evt);
            }
        });
        TraSach.add(jButton4);
        jButton4.setBounds(220, 250, 90, 30);

        jButton5.setText("Mất sách");
        jButton5.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jButton5ActionPerformed(evt);
            }
        });
        TraSach.add(jButton5);
        jButton5.setBounds(430, 160, 80, 30);

        jTabbedPane1.addTab("Trả Sách", TraSach);

        TruyVan.setLayout(null);

        TruyVan_tbDonMuon.setModel(new javax.swing.table.DefaultTableModel(
            new Object [][] {

            },
            new String [] {
                "Mã mượn", "Tên khách hàng", "Tên sách", "Số lượng mượn", "Ngày mượn", "Ngày trả"
            }
        ) {
            Class[] types = new Class [] {
                java.lang.String.class, java.lang.String.class, java.lang.String.class, java.lang.Integer.class, java.lang.String.class, java.lang.String.class
            };

            public Class getColumnClass(int columnIndex) {
                return types [columnIndex];
            }
        });
        jScrollPane6.setViewportView(TruyVan_tbDonMuon);

        TruyVan.add(jScrollPane6);
        jScrollPane6.setBounds(80, 170, 880, 500);

        TruyVan_bt.setFont(new java.awt.Font("Segoe UI", 0, 36)); // NOI18N
        TruyVan_bt.setText("Truy vấn");
        TruyVan_bt.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                TruyVan_btActionPerformed(evt);
            }
        });
        TruyVan.add(TruyVan_bt);
        TruyVan_bt.setBounds(780, 40, 210, 80);

        TruyVan_lbQuaHan.setFont(new java.awt.Font("Segoe UI", 0, 24)); // NOI18N
        TruyVan_lbQuaHan.setText("Quá hạn Trả");
        TruyVan_lbQuaHan.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                TruyVan_lbQuaHanActionPerformed(evt);
            }
        });
        TruyVan.add(TruyVan_lbQuaHan);
        TruyVan_lbQuaHan.setBounds(130, 40, 180, 40);

        TruyVan_lbLayTT.setFont(new java.awt.Font("Segoe UI", 0, 24)); // NOI18N
        TruyVan_lbLayTT.setText("Lấy thông tin");
        TruyVan_lbLayTT.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                TruyVan_lbLayTTActionPerformed(evt);
            }
        });
        TruyVan.add(TruyVan_lbLayTT);
        TruyVan_lbLayTT.setBounds(360, 40, 190, 40);

        jTabbedPane1.addTab("Truy vấn đơn mượn", TruyVan);

        BanDoc.setLayout(null);

        BanDoc_btSua.setFont(new java.awt.Font("Segoe UI", 0, 14)); // NOI18N
        BanDoc_btSua.setText("Sửa thông tin");
        BanDoc_btSua.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                BanDoc_btSuaActionPerformed(evt);
            }
        });
        BanDoc.add(BanDoc_btSua);
        BanDoc_btSua.setBounds(530, 80, 130, 30);

        BanDoc_txtMa.setFont(new java.awt.Font("Segoe UI", 0, 14)); // NOI18N
        BanDoc_txtMa.setEnabled(false);
        BanDoc.add(BanDoc_txtMa);
        BanDoc_txtMa.setBounds(220, 30, 190, 30);

        BanDoc_txtTenBanDoc.setFont(new java.awt.Font("Segoe UI", 0, 14)); // NOI18N
        BanDoc.add(BanDoc_txtTenBanDoc);
        BanDoc_txtTenBanDoc.setBounds(220, 80, 190, 30);

        BanDoc_txtSDT.setFont(new java.awt.Font("Segoe UI", 0, 14)); // NOI18N
        BanDoc.add(BanDoc_txtSDT);
        BanDoc_txtSDT.setBounds(220, 130, 190, 30);

        BanDoc_tbBanDoc.setModel(new javax.swing.table.DefaultTableModel(
            new Object [][] {
                {null, null, null},
                {null, null, null},
                {null, null, null},
                {null, null, null}
            },
            new String [] {
                "Mã bạn đọc", "Tên bạn đọc", "Số điện thoại"
            }
        ) {
            Class[] types = new Class [] {
                java.lang.String.class, java.lang.String.class, java.lang.String.class
            };

            public Class getColumnClass(int columnIndex) {
                return types [columnIndex];
            }
        });
        jScrollPane7.setViewportView(BanDoc_tbBanDoc);

        BanDoc.add(jScrollPane7);
        jScrollPane7.setBounds(110, 240, 890, 380);

        BanDoc_lbSDT.setFont(new java.awt.Font("Segoe UI", 0, 14)); // NOI18N
        BanDoc_lbSDT.setText("Số điện thoại:");
        BanDoc.add(BanDoc_lbSDT);
        BanDoc_lbSDT.setBounds(100, 130, 100, 30);

        BanDoc_lbMa.setFont(new java.awt.Font("Segoe UI", 0, 14)); // NOI18N
        BanDoc_lbMa.setText("Mã:");
        BanDoc.add(BanDoc_lbMa);
        BanDoc_lbMa.setBounds(100, 30, 100, 30);

        BanDoc_lbTenBanDoc.setFont(new java.awt.Font("Segoe UI", 0, 14)); // NOI18N
        BanDoc_lbTenBanDoc.setText("Tên bạn đọc:");
        BanDoc.add(BanDoc_lbTenBanDoc);
        BanDoc_lbTenBanDoc.setBounds(100, 80, 100, 30);

        BanDoc_btXoa.setFont(new java.awt.Font("Segoe UI", 0, 14)); // NOI18N
        BanDoc_btXoa.setText("Xóa bạn đọc");
        BanDoc_btXoa.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                BanDoc_btXoaActionPerformed(evt);
            }
        });
        BanDoc.add(BanDoc_btXoa);
        BanDoc_btXoa.setBounds(530, 130, 130, 30);

        BanDoc_btThem.setFont(new java.awt.Font("Segoe UI", 0, 14)); // NOI18N
        BanDoc_btThem.setText("Thêm bạn đọc");
        BanDoc_btThem.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                BanDoc_btThemActionPerformed(evt);
            }
        });
        BanDoc.add(BanDoc_btThem);
        BanDoc_btThem.setBounds(530, 30, 130, 30);

        BanDoc_btXacNhan.setText("Xác nhận");
        BanDoc_btXacNhan.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                BanDoc_btXacNhanActionPerformed(evt);
            }
        });
        BanDoc.add(BanDoc_btXacNhan);
        BanDoc_btXacNhan.setBounds(820, 180, 100, 40);

        jButton1.setText("Làm mới");
        jButton1.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jButton1ActionPerformed(evt);
            }
        });
        BanDoc.add(jButton1);
        jButton1.setBounds(710, 180, 90, 40);

        jTabbedPane1.addTab("Bạn đọc", BanDoc);

        Info_lbTK.setFont(new java.awt.Font("Times New Roman", 1, 36)); // NOI18N
        Info_lbTK.setText("Tên tài khoản:");

        Info_txtUsername.setFont(new java.awt.Font("Times New Roman", 0, 36)); // NOI18N
        Info_txtUsername.setEnabled(false);

        Info_tstTen.setFont(new java.awt.Font("Times New Roman", 0, 36)); // NOI18N
        Info_tstTen.setEnabled(false);

        info_lbTen.setFont(new java.awt.Font("Times New Roman", 1, 36)); // NOI18N
        info_lbTen.setText("Họ và tên:");

        Info_txtSDT.setFont(new java.awt.Font("Times New Roman", 0, 36)); // NOI18N
        Info_txtSDT.setEnabled(false);

        info_lbSDT.setFont(new java.awt.Font("Times New Roman", 1, 36)); // NOI18N
        info_lbSDT.setText("Điện thoại:");

        Info_LogOut.setFont(new java.awt.Font("Segoe UI", 0, 36)); // NOI18N
        Info_LogOut.setText("Đăng xuất");
        Info_LogOut.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                Info_LogOutActionPerformed(evt);
            }
        });

        javax.swing.GroupLayout jPanel3Layout = new javax.swing.GroupLayout(jPanel3);
        jPanel3.setLayout(jPanel3Layout);
        jPanel3Layout.setHorizontalGroup(
            jPanel3Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel3Layout.createSequentialGroup()
                .addGap(109, 109, 109)
                .addGroup(jPanel3Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.TRAILING)
                    .addGroup(jPanel3Layout.createSequentialGroup()
                        .addComponent(info_lbSDT)
                        .addGap(47, 47, 47)
                        .addComponent(Info_txtSDT, javax.swing.GroupLayout.PREFERRED_SIZE, 557, javax.swing.GroupLayout.PREFERRED_SIZE))
                    .addGroup(jPanel3Layout.createSequentialGroup()
                        .addComponent(info_lbTen)
                        .addGap(47, 47, 47)
                        .addComponent(Info_tstTen, javax.swing.GroupLayout.PREFERRED_SIZE, 557, javax.swing.GroupLayout.PREFERRED_SIZE))
                    .addGroup(jPanel3Layout.createSequentialGroup()
                        .addComponent(Info_lbTK)
                        .addGap(47, 47, 47)
                        .addComponent(Info_txtUsername, javax.swing.GroupLayout.PREFERRED_SIZE, 557, javax.swing.GroupLayout.PREFERRED_SIZE)))
                .addContainerGap(188, Short.MAX_VALUE))
            .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, jPanel3Layout.createSequentialGroup()
                .addContainerGap(javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                .addComponent(Info_LogOut, javax.swing.GroupLayout.PREFERRED_SIZE, 230, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addGap(134, 134, 134))
        );
        jPanel3Layout.setVerticalGroup(
            jPanel3Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(jPanel3Layout.createSequentialGroup()
                .addGap(84, 84, 84)
                .addGroup(jPanel3Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(Info_lbTK)
                    .addComponent(Info_txtUsername, javax.swing.GroupLayout.PREFERRED_SIZE, 43, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addGap(18, 18, 18)
                .addGroup(jPanel3Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(info_lbTen)
                    .addComponent(Info_tstTen, javax.swing.GroupLayout.PREFERRED_SIZE, 43, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addGap(18, 18, 18)
                .addGroup(jPanel3Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(info_lbSDT)
                    .addComponent(Info_txtSDT, javax.swing.GroupLayout.PREFERRED_SIZE, 43, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED, 235, Short.MAX_VALUE)
                .addComponent(Info_LogOut, javax.swing.GroupLayout.PREFERRED_SIZE, 58, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addGap(191, 191, 191))
        );

        jTabbedPane1.addTab("Thông tin tài khoản", jPanel3);

        javax.swing.GroupLayout layout = new javax.swing.GroupLayout(getContentPane());
        getContentPane().setLayout(layout);
        layout.setHorizontalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addComponent(jTabbedPane1, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
        );
        layout.setVerticalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, layout.createSequentialGroup()
                .addContainerGap()
                .addComponent(jTabbedPane1, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
        );

        pack();
    }// </editor-fold>//GEN-END:initComponents

    private void loadTableSachDaMuon(String maKH) {
        DefaultTableModel model = (DefaultTableModel) Muon_tbDSMuon.getModel();
        model.setRowCount(0);
        
        ArrayList<Muon> list = managerController.GetMuonByMa(maKH);
        
        if(list.isEmpty()) {
            JOptionPane.showMessageDialog(this, "Không tìm thấy sách đã mượn!");
            return;
        }
        
        for(Muon m : list) {
            model.addRow(new Object[]
            {
                m.getMaMuon(),
                m.getMaSach(),
                m.getSoLuong(),
                m.getNgayMuon()
            }); 
        }
    }
    
    // Clear dữ liệu Bảng nếu KH không tồn tại
    private void clearTableMuon() {
        DefaultTableModel model = (DefaultTableModel) Muon_tbDSMuon.getModel();
        model.setRowCount(0);
    }
    
    private void loadTableKhoSach()  {
            DefaultTableModel model = (DefaultTableModel) Muon_tbSach.getModel();
            model.setRowCount(0);
            
            ArrayList<Sach> list = managerController.GetAllSach();
            
            for(Sach s : list) {
                model.addRow(new Object[] {
                    s.getMaSach(),
                    s.getTenSach(),
                    s.getTacGia(),
                    managerController.GetTheLoaiByMa(s.getMaTheLoai()).getTenTheLoai(),
                    s.getSoLuong()
                });
            }
    }
    
    private void loadTableKH(ArrayList<KhachHang> list) {
        DefaultTableModel model = (DefaultTableModel) TimKiem_tbDSKH.getModel();
        model.setRowCount(0);
        
        for(KhachHang kh : list) {
            model.addRow(new Object[] {
                kh.getMaKH(),
                kh.getTenKH(),
                kh.getSdtKH()
            });
        }
    }
    
    private void loadTableBanDoc(){
        DefaultTableModel model = (DefaultTableModel) BanDoc_tbBanDoc.getModel();
        model.setRowCount(0);
        ArrayList<KhachHang> list = managerController.GetAllKhachHang();
        for(KhachHang kh : list) {
            model.addRow(new Object[] {
                kh.getMaKH(),
                kh.getTenKH(),
                kh.getSdtKH()
            });
        }
        loadTableKH(managerController.GetAllKhachHang());
    }
    
    private void TruyVan_btActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_TruyVan_btActionPerformed
        // TODO add your handling code here:
        
        DefaultTableModel model = (DefaultTableModel) TruyVan_tbDonMuon.getModel();
        model.setRowCount(0);
        ArrayList<Muon> list = managerController.GetAllMuon();
        for(Muon m : list) {
                model.addRow(new Object[] {
                    m.getMaMuon(),
                    managerController.GetKhachHangByMa(m.getMaKH()).getTenKH(),
                    managerController.GetSachByMa(m.getMaSach()).getTenSach(),
                    m.getSoLuong(),
                    m.getNgayMuon(),
                    m.getNgayTra()
                });
        }
    }//GEN-LAST:event_TruyVan_btActionPerformed

    private void BanDoc_btSuaActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_BanDoc_btSuaActionPerformed
        // TODO add your handling code here:
        int row = BanDoc_tbBanDoc.getSelectedRow();
 
        // 1. Kiểm tra đã chọn bạn đọc chưa
        if (row == -1) {
            JOptionPane.showMessageDialog(this,
                    "Vui lòng chọn bạn đọc cần sửa!");
            return;
        }


        // 2. Kiểm tra dữ liệu nhập
        if (BanDoc_txtTenBanDoc.getText().trim().isEmpty() ||
                BanDoc_txtSDT.getText().trim().isEmpty()) {

            JOptionPane.showMessageDialog(this,
                    "Vui lòng nhập đầy đủ dữ liệu!");
            return;
        }

        // 3. Hỏi xác nhận
        int confirm = JOptionPane.showConfirmDialog(
                this,
                "Xác nhận sửa thông tin?",
                "Xác nhận",
                JOptionPane.YES_NO_OPTION
        );

        if (confirm != JOptionPane.YES_OPTION) return;

        // 4. LẤY MÃ KH (KHÔNG ĐƯỢC THAY ĐỔI)
        String maKH = BanDoc_txtMa.getText().trim();

        // 5. GỌI CONTROLLER → UPDATE DB
        boolean result = managerController.UpdateKhachHang(
                new KhachHang(
                        maKH,
                        BanDoc_txtTenBanDoc.getText().trim(),
                        BanDoc_txtSDT.getText().trim()
                )
        );

        if (!result) {
            JOptionPane.showMessageDialog(this,
                    "Cập nhật bạn đọc thất bại!");
            return;
        }
        

        // 7. DB OK → CẬP NHẬT JTable
        LoadTableBanDoc();

        resetUIBanDoc();
    }//GEN-LAST:event_BanDoc_btSuaActionPerformed

    private void BanDoc_btXoaActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_BanDoc_btXoaActionPerformed
        // TODO add your handling code here:
        int row = BanDoc_tbBanDoc.getSelectedRow();
        
        if(row < 0) {
            JOptionPane.showMessageDialog(this, "Vui lòng chọn bạn đọc cần xóa!");
            return;
        }
        
        int confirm = JOptionPane.showConfirmDialog(this, "Xác nhận xóa bạn đọc này?", "Xác nhận", JOptionPane.YES_NO_OPTION);
        
        if(confirm != JOptionPane.YES_OPTION) return;
        
        // Gọi Controller xóa DB
        String maKH = BanDoc_tbBanDoc.getValueAt(row, 0).toString();
        boolean result = managerController.DeleteKhachHang(maKH);
        
        if(!result) {
            JOptionPane.showMessageDialog(this, "Xóa bạn đọc thất bại!");
            return;
        }
        
        DefaultTableModel model = (DefaultTableModel) BanDoc_tbBanDoc.getModel();
        model.removeRow(row);
        
        JOptionPane.showMessageDialog(this, "Xóa bạn đọc thành công!");
        
        loadTableKH(managerController.GetAllKhachHang());

        resetUIBanDoc();
    }//GEN-LAST:event_BanDoc_btXoaActionPerformed
    
    private void resetUIBanDoc() {
        BanDoc_txtMa.setText("");
        BanDoc_txtTenBanDoc.setText("");
        BanDoc_txtSDT.setText("");
    }
    
    private void LoadTableBanDoc(){
        DefaultTableModel model = (DefaultTableModel) BanDoc_tbBanDoc.getModel();
        model.setRowCount(0);
        ArrayList<KhachHang> arr = managerController.GetAllKhachHang();
        for(KhachHang kh : arr){
                model.addRow(new Object[] {
            kh.getMaKH(),
            kh.getTenKH(),
            kh.getSdtKH()
        });
        }
 
    }
    
    private void BanDoc_btThemActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_BanDoc_btThemActionPerformed
 
        if(BanDoc_txtTenBanDoc.getText().trim().isEmpty() || BanDoc_txtSDT.getText().trim().isEmpty()) {
            JOptionPane.showMessageDialog(this, "Vui lòng nhập đầy đủ dữ liệu!");
            return;
        }
        
        // Hộp thoại xác nhận
        int confirm = JOptionPane.showConfirmDialog(this, "Xác nhận thêm bạn đọc này?", "Xác nhận", JOptionPane.YES_NO_OPTION);
        if(managerController.GetKhachHangByMa(BanDoc_txtMa.getText().trim()) != null) {
            KhachHang kh = managerController.GetKhachHangByMa(BanDoc_txtMa.getText());
            BanDoc_txtMa.setText(kh.getMaKH());
            BanDoc_txtTenBanDoc.setText(kh.getTenKH());
            BanDoc_txtSDT.setText(kh.getSdtKH());
            JOptionPane.showMessageDialog(this, "Mã bạn đọc đã tồn tại!");
            return;
        }
        if(managerController.GetKhachHangBySdt(BanDoc_txtSDT.getText().trim()) != null) {
            KhachHang kh = managerController.GetKhachHangBySdt(BanDoc_txtSDT.getText());
            BanDoc_txtMa.setText(kh.getMaKH());
            BanDoc_txtTenBanDoc.setText(kh.getTenKH());
            BanDoc_txtSDT.setText(kh.getSdtKH());
            JOptionPane.showMessageDialog(this, "Số điện thoại đã tồn tại!");
            return;
        }
        if(confirm != JOptionPane.YES_OPTION) {
            return;
        }
        
        if(!managerController.AddKhachHang(new KhachHang(
                "",
                BanDoc_txtTenBanDoc.getText().trim(),
                BanDoc_txtSDT.getText().trim())) ) {
            JOptionPane.showMessageDialog(this, "Thêm bạn đọc thất bại!");
            return;
        }
        
        JOptionPane.showMessageDialog(this, "Thêm bạn đọc thành công!");
        loadTableBanDoc();
        //Reset giao diện
        resetUIBanDoc();
    }//GEN-LAST:event_BanDoc_btThemActionPerformed

    private void TimKiem_btTimActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_TimKiem_btTimActionPerformed
        // TODO add your handling code here:
        int index = TimKiem_cbGet.getSelectedIndex();
        
        DefaultTableModel model = (DefaultTableModel) TimKiem_tbDSKH.getModel();
        model.setRowCount(0);
        
        // Tìm theo Mã khách hàng
        switch (index) {
            case 0 -> {
                String maKH = TimKiem_txtMaKH.getText().trim();
                if(maKH.isEmpty()) {
                    JOptionPane.showMessageDialog(this, "Vui lòng nhập mã bạn đọc trước!");
                    return;
                }   KhachHang khachHang = managerController.GetKhachHangByMa(maKH);
                if(khachHang == null) {
                    JOptionPane.showMessageDialog(this, "Không tìm thấy bạn đọc này!");
                    return;
                }   model.addRow(new Object[]{
                    khachHang.getMaKH(),    
                    khachHang.getTenKH(),
                    khachHang.getSdtKH()
                });
            }
            case 1 -> {
                String tenKH = TimKiem_txtTenKH.getText().trim();
                if(tenKH.isEmpty()) {
                    JOptionPane.showMessageDialog(this, "Vui lòng nhập tên bạn đọc trước!");
                    return;
                }   ArrayList<KhachHang> list = managerController.GetKhachHangByTen(tenKH);
                if(list.isEmpty()) {
                    JOptionPane.showMessageDialog(this, "Không tìm thấy bạn đọc này!");
                }   loadTableKH(list);
            }
            case 2 -> {
                String sdt = TimKiem_txtSDT.getText().trim();
                if(sdt.isEmpty()) {
                    JOptionPane.showMessageDialog(this, "Vui lòng nhập số điện thoại trước!");
                    return;
                }   KhachHang kh = managerController.GetKhachHangBySdt(sdt);
                if(kh == null) {
                    JOptionPane.showMessageDialog(this, "Không tìm thấy bạn đọc này!");
                } model.addRow(new Object[] {
                    kh.getMaKH(),
                    kh.getTenKH(),
                    kh.getSdtKH()
                });
            }
            default -> {
            }
        }
    }//GEN-LAST:event_TimKiem_btTimActionPerformed

    private void TimKiem_btMuonActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_TimKiem_btMuonActionPerformed
        // TODO add your handling code here:
        int row = TimKiem_tbDSKH.getSelectedRow();
        
        String maKH = TimKiem_tbDSKH.getValueAt(row, 0).toString();
        String tenKH = TimKiem_tbDSKH.getValueAt(row, 1).toString();
        
        // Chuyển sang tab Mượn
        Muon_txtMaKH.setText(maKH);
        Muon_txtTenKH.setText(tenKH);
        
        // Chuyển sang tab Tra
        TraSach_txtMaKH.setText(maKH);
        TraSach_txtTenKH.setText(tenKH);
        LoadTableDaMuon(maKH);
        
        
        tabManager.setSelectedIndex(0);
    }//GEN-LAST:event_TimKiem_btMuonActionPerformed

    private void TimKiem_cbGetActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_TimKiem_cbGetActionPerformed
        // TODO add your handling code here:
        
        int index = TimKiem_cbGet.getSelectedIndex();
        TimKiem_cbGet.setSelectedIndex(index);
        
        // Reset text
        TimKiem_txtMaKH.setText("");
        TimKiem_txtTenKH.setText("");
        TimKiem_txtSDT.setText("");
        
        switch (index) {
            case 0 -> {
                TimKiem_txtMaKH.setEnabled(true);
                TimKiem_txtTenKH.setEnabled(false);
                TimKiem_txtSDT.setEnabled(false);
            }
            case 1 -> {
                TimKiem_txtMaKH.setEnabled(false);
                TimKiem_txtTenKH.setEnabled(true);
                TimKiem_txtSDT.setEnabled(false);
            }
            case 2 -> {
                TimKiem_txtMaKH.setEnabled(false);
                TimKiem_txtTenKH.setEnabled(false);
                TimKiem_txtSDT.setEnabled(true);
            }
            default -> {
            }
        }
    }//GEN-LAST:event_TimKiem_cbGetActionPerformed

    private void Muon_btActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_Muon_btActionPerformed
        // Kiểm tra xem đã tồn tại bạn đọc chưa
        String maKH = Muon_txtMaKH.getText().trim();
        String tenKH = Muon_txtTenKH.getText().trim();
        if("".equals(maKH) || "".equals(tenKH)) {
            JOptionPane.showMessageDialog(this, "Không tìm thấy bạn đọc, không thể tiến hành mượn sách!");
            return;
        }

        // Kiểm tra xem đã chọn sách chưa
        int selected = Muon_tbSach.getSelectedRow();

        if(selected == -1) {
            JOptionPane.showMessageDialog(this, "Vui lòng chọn sách trong kho!");
            return;
        }

        // Kiểm tra số lượng mượn
        String soLuongText = Muon_txtSLMuon.getText().trim();
        if(soLuongText.isEmpty()) {
            JOptionPane.showMessageDialog(this, "Vui lòng nhập số lượng mượn!");
            return;
        }

        int soLuongMuon;
        try {
            soLuongMuon = Integer.parseInt(soLuongText);
            if(soLuongMuon <= 0) throw new NumberFormatException();
        } catch (NumberFormatException e) {
            JOptionPane.showMessageDialog(this, "Vui lòng nhập đúng định dạng số!");
            return;
        }

        // Lấy dữ liệu từ kho
        String maSach = Muon_tbSach.getValueAt(selected, 0).toString();
        String tenSach = Muon_tbSach.getValueAt(selected, 1).toString();
        String tacGia = Muon_tbSach.getValueAt(selected, 3).toString();
        int soLuongKho = Integer.parseInt(Muon_tbSach.getValueAt(selected, 4).toString());

        // So sánh trong kho
        int soLuongCon = soLuongKho - soLuongMuon;
        if(soLuongMuon > soLuongKho) {
            JOptionPane.showMessageDialog(this, "Số lượng bạn nhập đã vượt quá số lượng trong kho!");
        }
        else {
            // Thêm vào bảng DS Mượn
            DefaultTableModel model = (DefaultTableModel) Muon_tbDSMuon.getModel();
            model.addRow(new Object[] {
                maSach,
                tenSach,
                tacGia,
                soLuongMuon
            });
            // Trừ số lượng trong kho
            Muon_tbSach.setValueAt(soLuongCon, selected, 4);
        }

        // Reset input
        Muon_txtSLMuon.setText("");

    }//GEN-LAST:event_Muon_btActionPerformed

    private void Muon_btTimKiemSachActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_Muon_btTimKiemSachActionPerformed
        DefaultTableModel model =
            (DefaultTableModel) Muon_tbSach.getModel();
    model.setRowCount(0); // Xóa dữ liệu cũ

    String loaiTim = Muon_cbTimTheo.getSelectedItem().toString();

    try {
            // ===== TÌM THEO MÃ SÁCH =====
            switch (loaiTim) {
                case "Mã Sách" -> {
                    String maSach = Muon_txtMaSachTimKiem.getText().trim();
                    if (maSach.isEmpty()) {
                        JOptionPane.showMessageDialog(this,
                                "Vui lòng nhập mã sách!");
                        return;
                    }       Sach s = sachService.GetSachByMa(maSach);
                    if (s == null) {
                        JOptionPane.showMessageDialog(this,
                                "Không tìm thấy sách!");
                        return;
                    }       model.addRow(new Object[]{
                        s.getMaSach(),
                        s.getTenSach(),
                        s.getTacGia(),
                        managerController.GetTheLoaiByMa(s.getMaTheLoai()).getTenTheLoai(),
                        s.getSoLuong()
                    });
                }
                case "Tên Sách" ->                     {
                        String tenSach = Muon_txtTenSachTimKiem.getText().trim();
                        if (tenSach.isEmpty()) {
                            JOptionPane.showMessageDialog(this,
                                    "Vui lòng nhập tên sách!");
                            return;
                        }           ArrayList<Sach> list = sachService.GetSachByTenSach(tenSach);
                        if (list == null || list.isEmpty()) {
                            JOptionPane.showMessageDialog(this,
                                    "Không tìm thấy sách!");
                            return;
                        }           for(Sach s : list) {
                            model.addRow(new Object[]{
                                s.getMaSach(),
                                s.getTenSach(),
                                s.getTacGia(),
                                managerController.GetTheLoaiByMa(s.getMaTheLoai()).getTenTheLoai(),
                                s.getSoLuong()
                            });
                        }                              }
                case "Thể Loại" ->                     {
                        String tl = Muon_txtTheLoaiTimKiem.getText().trim();
                        ArrayList<TheLoai> arr = managerController.GetAllTheLoai();
                        if (tl.isEmpty()) {
                            JOptionPane.showMessageDialog(this,
                                    "Vui lòng nhập tên thể loại!");
                            return;
                        }           ArrayList<Sach> list = new ArrayList<Sach>();
                        
                        for(TheLoai t : arr) {
                            if(t.getTenTheLoai().toLowerCase().contains(tl.toLowerCase())) {
                                list.addAll(sachService.GetSachByTheLoai(t.getMaTheLoai()));
                            }
                        }

                        if (list == null || list.isEmpty()) {
                            JOptionPane.showMessageDialog(this,
                                    "Không tìm thấy sách theo thể loại!");
                            return;
                        }           for (Sach s : list) {
                            model.addRow(new Object[]{
                                s.getMaSach(),
                                s.getTenSach(),
                                s.getTacGia(),
                                managerController.GetTheLoaiByMa(s.getMaTheLoai()).getTenTheLoai(),
                                s.getSoLuong()
                            });
                        }                              }
                default -> {
                }
            }

    } catch (HeadlessException | IOException | InterruptedException e) {
        JOptionPane.showMessageDialog(this,
                "Lỗi khi tìm kiếm sách!");
        }
    }//GEN-LAST:event_Muon_btTimKiemSachActionPerformed

    private void Muon_btXacNhanActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_Muon_btXacNhanActionPerformed
        // Kiểm tra người dùng
        String maKH = Muon_txtMaKH.getText().trim();
        String tenKH = Muon_txtTenKH.getText().trim();
        if("".equals(maKH) || "".equals(tenKH)) {
            JOptionPane.showMessageDialog(this, "Không tìm thấy bạn đọc, không thể tiến hành mượn sách!");
            return;
        }

        int selected = Muon_tbSach.getSelectedRow();

        if(selected == -1) {
            JOptionPane.showMessageDialog(this, "Vui lòng chọn sách trong kho!");
            return;
        }

        String tenSach = Muon_tbSach.getValueAt(selected, 1).toString();

        Muon_txtTenSach.setText(tenSach);
    }//GEN-LAST:event_Muon_btXacNhanActionPerformed

    private void Muon_cbTimTheoActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_Muon_cbTimTheoActionPerformed
        // TODO add your handling code here:
        int index = Muon_cbTimTheo.getSelectedIndex();
        Muon_cbTimTheo.setSelectedIndex(index);

        // Reset text
        Muon_txtMaSachTimKiem.setText("");
        Muon_txtTenSachTimKiem.setText("");
        Muon_txtTheLoaiTimKiem.setText("");

        switch (index) {
            case 0 -> {
                Muon_txtMaSachTimKiem.setEnabled(true);
                Muon_txtTenSachTimKiem.setEnabled(false);
                Muon_txtTheLoaiTimKiem.setEnabled(false);
            }
            case 1 -> {
                Muon_txtMaSachTimKiem.setEnabled(false);
                Muon_txtTenSachTimKiem.setEnabled(true);
                Muon_txtTheLoaiTimKiem.setEnabled(false);
            }
            case 2 -> {
                Muon_txtMaSachTimKiem.setEnabled(false);
                Muon_txtTenSachTimKiem.setEnabled(false);
                Muon_txtTheLoaiTimKiem.setEnabled(true);
            }
            default -> {
            }
        }
    }//GEN-LAST:event_Muon_cbTimTheoActionPerformed
                                                                    
    private void TraSach_cbTimKiemActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_TraSach_cbTimKiemActionPerformed
        // TODO add your handling code here:
        int index = TraSach_cbTimKiem.getSelectedIndex();
        TraSach_cbTimKiem.setSelectedIndex(index);

        // Reset text
        TraSach_txtMaSachTimKiem.setText("");
        TraSach_txtTenSachTimKiem.setText("");
        TraSach_txtTheLoaiTimKiem.setText("");
        TraSach_txtTheLoaiTimKiem.setText("");

        switch (index) {
            case 0 -> {
                TraSach_txtMaSachTimKiem.setEnabled(true);
                TraSach_txtTenSachTimKiem.setEnabled(false);
                TraSach_txtTheLoaiTimKiem.setEnabled(false);
            }
            case 1 -> {
                TraSach_txtMaSachTimKiem.setEnabled(false);
                TraSach_txtTenSachTimKiem.setEnabled(true);
                TraSach_txtTheLoaiTimKiem.setEnabled(false);
            }
            case 2 -> {
                TraSach_txtMaSachTimKiem.setEnabled(false);
                TraSach_txtTenSachTimKiem.setEnabled(false);
                TraSach_txtTheLoaiTimKiem.setEnabled(true);
            }
            default -> {
            }
        }
        
    }//GEN-LAST:event_TraSach_cbTimKiemActionPerformed

    private void TimKiem_btHienThiActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_TimKiem_btHienThiActionPerformed
        // TODO add your handling code here:
        ManagerController mg = new ManagerController();
        loadTableKH(mg.GetAllKhachHang());
    }//GEN-LAST:event_TimKiem_btHienThiActionPerformed

    private void Info_LogOutActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_Info_LogOutActionPerformed
        // TODO add your handling code here:
        Login lg = new Login();
        lg.setVisible(true);
        this.dispose();
    }//GEN-LAST:event_Info_LogOutActionPerformed

    private void TraSach_btActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_TraSach_btActionPerformed
        // TODO add your handling code here:
        // Kiểm tra xem đã tồn tại bạn đọc chưa
        String maKH = TraSach_txtMaKH.getText().trim();
        String tenKH = TraSach_txtTenKH.getText().trim();
        if("".equals(maKH) || "".equals(tenKH)) {
            JOptionPane.showMessageDialog(this, "Không tìm thấy bạn đọc, không thể tiến hành trả sách!");
            return;
        }

        // Kiểm tra xem đã chọn sách chưa
        int selected = TraSach_tbDSMuon.getSelectedRow();
        int row = Muon_tbSach.getSelectedRow();

        if(selected == -1) {
            JOptionPane.showMessageDialog(this, "Vui lòng chọn sách trong kho!");
            return;
        }

        // Kiểm tra số lượng mượn
        String soLuongText = TraSach_txtSLTra.getText().trim();
        if(soLuongText.isEmpty()) {
            JOptionPane.showMessageDialog(this, "Vui lòng nhập số lượng sách trả!");
            return;
        }

        int soLuongTra;
        int soLuongMuon = Integer.parseInt(TraSach_tbDSMuon.getValueAt(selected, 2).toString());
        try {
            soLuongTra = Integer.parseInt(soLuongText);
            if(soLuongTra <= 0 || soLuongTra > soLuongMuon) throw new NumberFormatException();
        } catch (NumberFormatException e) {
            JOptionPane.showMessageDialog(this, "Con số không hợp lệ!");
            return;
        }

        // Lấy dữ liệu từ bảng Mượn
        String maMuon = TraSach_tbDSMuon.getValueAt(selected, 0).toString();
        String tenSach = TraSach_tbDSMuon.getValueAt(selected, 1).toString();
        TraSach_tbDSMuon.setValueAt(soLuongMuon - soLuongTra, selected, 2);
        DefaultTableModel DSMuon =
            (DefaultTableModel) this.TraSach_tbDSTra.getModel();
            DSMuon.addRow(new Object[]{maMuon, tenSach, soLuongTra});

    }//GEN-LAST:event_TraSach_btActionPerformed

    private void Load_TraSachtable(ArrayList<Muon> ds){
        DefaultTableModel model = (DefaultTableModel) TraSach_tbDSMuon.getModel();
        model.setRowCount(0);
        for (Muon muon : ds) {
            model.addRow(new Object[]{
                muon.getMaMuon(),
                managerController.GetSachByMa(muon.getMaSach()).getTenSach(),
                muon.getSoLuong(),
                muon.getNgayMuon(),
                muon.getNgayTra()
            });
            
        }
    }
    private void TraSach_btTimKiemSachActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_TraSach_btTimKiemSachActionPerformed
        // TODO add your handling code here:
        String search = TraSach_cbTimKiem.getSelectedItem().toString();
        ArrayList<Muon> ds = new ArrayList<>();
        switch (search) {
            case "Mã sách" -> {
                String maSach = TraSach_txtMaSachTimKiem.getText().trim();
                if (maSach.isEmpty()) {
                            JOptionPane.showMessageDialog(this,
                                    "Vui lòng nhập mã sách!");
                            return;
                        }
                ds = managerController.GetMuonByMaSach(maSach);
                Load_TraSachtable(ds);
            }
            case "Tên sách" -> {
                String tenSach = TraSach_txtTenSachTimKiem.getText().trim();
                if (tenSach.isEmpty()) {
                            JOptionPane.showMessageDialog(this,
                                    "Vui lòng nhập tên sách!");
                            return;
                        }
                for(Sach s : managerController.GetAllSach()){
                    if(s.getTenSach().contains(tenSach)){
                        ds.addAll(managerController.GetMuonByMaSach(s.getMaSach()));
                    }
                }
                Load_TraSachtable(ds);
            }
            case "Thể loại" -> {
                String theLoai = TraSach_txtTheLoaiTimKiem.getText().trim().toLowerCase();
                ArrayList<TheLoai> arr = managerController.GetAllTheLoai();
                        if (theLoai.isEmpty()) {
                            JOptionPane.showMessageDialog(this,
                                    "Vui lòng nhập tên thể loại!");
                            return;
                        }           ArrayList<Sach> list = new ArrayList<Sach>();
                    
                        for(TheLoai t : arr) {
                            if(t.getTenTheLoai().toLowerCase().contains(theLoai.toLowerCase())) {
                                list.addAll(managerController.GetSachByTheLoai(t.getMaTheLoai()));
                            }
                        }

                        for(Sach s : list){
                            ds.addAll(managerController.GetMuonByMaSach(s.getMaSach()));
                        }
                Load_TraSachtable(ds);
            }
        }

    }//GEN-LAST:event_TraSach_btTimKiemSachActionPerformed

    private void Muon_HuyMuonActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_Muon_HuyMuonActionPerformed
        // TODO add your handling code here:
        DefaultTableModel DSMuon =
            (DefaultTableModel) this.Muon_tbDSMuon.getModel();
        DefaultTableModel Muon_tbSach =
            (DefaultTableModel) this.Muon_tbSach.getModel();
        
        // Lấy mã sách từ bảng DS Mượn
        String maSach = DSMuon.getValueAt(Muon_tbDSMuon.getSelectedRow(), 0).toString();
        
        //Thêm lại số lượng sách vào kho
        // Lấy số lượng sách mượn từ bảng DS Mượn
        int soLuongMuon = Integer.parseInt(DSMuon.getValueAt(Muon_tbDSMuon.getSelectedRow(), 3).toString());
        
        // Cập nhật số lượng sách trong bảng Sách
        for (int i = 0; i < Muon_tbSach.getRowCount(); i++) {
            if (Muon_tbSach.getValueAt(i, 0).toString().equals(maSach)) {
                int soLuongHienTai = Integer.parseInt(Muon_tbSach.getValueAt(i, 4).toString());
                Muon_tbSach.setValueAt(soLuongHienTai + soLuongMuon, i, 4);
                break;
            }
        }

        // Xóa sách khỏi bảng DS Mượn
        DSMuon.removeRow(Muon_tbDSMuon.getSelectedRow());
    }//GEN-LAST:event_Muon_HuyMuonActionPerformed
    
    private void LoadTableDaMuon(String MaKH){
        DefaultTableModel model = (DefaultTableModel) TraSach_tbDSMuon.getModel();
        model.setRowCount(0);
        for (Muon muon : managerController.GetMuonByMa(MaKH)) {
            model.addRow(new Object[]{
                muon.getMaMuon(),
                managerController.GetSachByMa(muon.getMaSach()).getTenSach(),
                muon.getSoLuong(),
                muon.getNgayMuon(),
                muon.getNgayTra()
            });
            
        }
    }
    
    private void Muon_btConfimrMuonActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_Muon_btConfimrMuonActionPerformed
        // TODO add your handling code here:
        DefaultTableModel DSMuon =
            (DefaultTableModel) this.Muon_tbDSMuon.getModel();
        if(DSMuon.getRowCount() == 0) {
            JOptionPane.showMessageDialog(this, "Danh sách mượn trống!");
            return;
        }
        String maKH = Muon_txtMaKH.getText().trim();

        if(maKH.isEmpty()) {
            JOptionPane.showMessageDialog(this, "Vui lòng nhập mã khách hàng!");
            return;
        }
        // Thêm dữ liệu vào database
        for(int i = 0; i < DSMuon.getRowCount(); i++) {
            String maSach = DSMuon.getValueAt(i, 0).toString();
            int soLuong = Integer.parseInt(DSMuon.getValueAt(i, 3).toString());
            // Thêm dữ liệu vào database
            managerController.MuonSach(new Muon(" ", maKH, maSach, soLuong, LocalDate.now().toString(), LocalDate.now().plusMonths(3).toString()), tk.getUsername());
        }
        
        DSMuon.setRowCount(0);
        LoadTableDaMuon(maKH);
    }//GEN-LAST:event_Muon_btConfimrMuonActionPerformed

    private void TruyVan_lbQuaHanActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_TruyVan_lbQuaHanActionPerformed
        // TODO add your handling code here:
        DefaultTableModel model = (DefaultTableModel) TruyVan_tbDonMuon.getModel();
        model.setRowCount(0);
        ArrayList<Muon> list = managerController.GetAllMuon();
        for(Muon m : list) {
            if(m.getNgayTra().before(Date.valueOf(LocalDate.now()))) {
                model.addRow(new Object[]{
                    m.getMaMuon(),
                    m.getMaKH(),
                    m.getMaSach(),
                    m.getSoLuong(),
                    m.getNgayMuon(),
                    m.getNgayTra()
                });
            }
        }
    }//GEN-LAST:event_TruyVan_lbQuaHanActionPerformed

    private void TruyVan_lbLayTTActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_TruyVan_lbLayTTActionPerformed
        // TODO add your handling code here:
        Info info = new Info();
        Muon muon = managerController.GetMuonByMaMuon(TruyVan_tbDonMuon.getValueAt(TruyVan_tbDonMuon.getSelectedRow(), 0).toString());
        KhachHang kh = managerController.GetKhachHangByMa(muon.getMaKH());
        info.Get(kh.getTenKH(), kh.getSdtKH());
        info.setVisible(true);
    }//GEN-LAST:event_TruyVan_lbLayTTActionPerformed

    private void TraSach_btXacNhanActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_TraSach_btXacNhanActionPerformed
        // TODO add your handling code here:
        String maKH = TraSach_txtMaKH.getText().trim();
        String tenKH = TraSach_txtTenKH.getText().trim();
        if("".contains(maKH) || "".contains(tenKH)) {
            JOptionPane.showMessageDialog(this, "Không tìm thấy bạn đọc, không thể tiến hành mượn sách!");
            return;
        }

        int selected = TraSach_tbDSMuon.getSelectedRow();

        if(selected == -1) {
            JOptionPane.showMessageDialog(this, "Vui lòng chọn sách trong kho!");
            return;
        }
        
        String tenSach = TraSach_tbDSMuon.getValueAt(selected, 0).toString();

        TraSach_txtMaMuon.setText(tenSach);
    }//GEN-LAST:event_TraSach_btXacNhanActionPerformed

    private void TraSach_txtNgayMuonActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_TraSach_txtNgayMuonActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_TraSach_txtNgayMuonActionPerformed

    private void BanDoc_btXacNhanActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_BanDoc_btXacNhanActionPerformed
        // TODO add your handling code here:
        int row = BanDoc_tbBanDoc.getSelectedRow();
 
        // 1. Kiểm tra đã chọn bạn đọc chưa
        if (row == -1) {
            JOptionPane.showMessageDialog(this,
                    "Vui lòng chọn bạn đọc để thực hiện!");
            return;
        }
        String maKH = BanDoc_tbBanDoc.getValueAt(row, 0).toString();
        String tenKH = BanDoc_tbBanDoc.getValueAt(row, 1).toString();
        String soDT = BanDoc_tbBanDoc.getValueAt(row, 2).toString();
        BanDoc_txtMa.setText(maKH);
        BanDoc_txtTenBanDoc.setText(tenKH);
        BanDoc_txtSDT.setText(soDT);
    }//GEN-LAST:event_BanDoc_btXacNhanActionPerformed

    private void jButton1ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jButton1ActionPerformed
        // TODO add your handling code here:
        resetUIBanDoc();
    }//GEN-LAST:event_jButton1ActionPerformed

    private void jButton2ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jButton2ActionPerformed
        // TODO add your handling code here:
        loadTableKhoSach();
    }//GEN-LAST:event_jButton2ActionPerformed

    private void TraSach_btHienThiActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_TraSach_btHienThiActionPerformed
        // TODO add your handling code here:
        String maKH = BanDoc_txtMa.getText();
        loadTableSachDaMuon(maKH);
    }//GEN-LAST:event_TraSach_btHienThiActionPerformed

    private void jButton3ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jButton3ActionPerformed
        // TODO add your handling code here:
        for(int i = 0; i < TraSach_tbDSTra.getRowCount(); i++) {
            managerController.TraSach(
                TraSach_tbDSTra.getValueAt(i, 0).toString(), 
                tk.getUsername(), 
                Integer.parseInt(TraSach_tbDSTra.getValueAt(i, 2).toString())
        );
        }
        JOptionPane.showMessageDialog(this, "Trả sách thành công!");
        
        DefaultTableModel model = (DefaultTableModel) TraSach_tbDSTra.getModel();
        model.setRowCount(0);

        LoadTableDaMuon(TraSach_txtMaKH.getText());
    }//GEN-LAST:event_jButton3ActionPerformed
    
    private void jButton5ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jButton5ActionPerformed
        // TODO add your handling code here:
         int selected = TraSach_tbDSMuon.getSelectedRow();

        if(selected == -1) {
            JOptionPane.showMessageDialog(this, "Vui lòng chọn sách trong kho!");
            return;
        }

        String maMuon = TraSach_txtMaMuon.getText().trim();
        String maKH = TraSach_txtMaKH.getText().trim();
        String SoLuongMat = TraSach_txtSLTra.getText().trim();

        if(SoLuongMat.isEmpty()) {
            JOptionPane.showMessageDialog(this, "Vui lòng nhập số lượng sách trả!");
            return;
        }

        int soLuongMatint;
        int soLuongMuon = Integer.parseInt(TraSach_tbDSMuon.getValueAt(selected, 2).toString());
        try {
            soLuongMatint = Integer.parseInt(SoLuongMat);
            if(soLuongMatint <= 0 || soLuongMatint > soLuongMuon) throw new NumberFormatException();
        } catch (NumberFormatException e) {
            JOptionPane.showMessageDialog(this, "Con số không hợp lệ!");
            return;
        }

        managerController.MatSach(maMuon,tk.getUsername(),soLuongMatint);
        LoadTableDaMuon(TraSach_txtMaKH.getText());
    }//GEN-LAST:event_jButton5ActionPerformed

    private void jButton4ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jButton4ActionPerformed
        // TODO add your handling code here:
        int select = TraSach_tbDSMuon.getSelectedRow();
        if(select == -1) {
            JOptionPane.showMessageDialog(this, "Vui lòng chọn sách trong kho!");
            return;
        }
        String maMuon = TraSach_tbDSTra.getValueAt(select, 0).toString();
        String SoLuong = TraSach_tbDSTra.getValueAt(select, 2).toString();

        for(int i = 0; i < TraSach_tbDSMuon.getRowCount(); i++) {
            if(TraSach_tbDSMuon.getValueAt(i, 0).toString().equals(maMuon)) {
                TraSach_tbDSMuon.setValueAt(Integer.parseInt(SoLuong)+Integer.parseInt(TraSach_tbDSMuon.getValueAt(i, 2).toString()), i, 2);
                break;
            }
        }
        DefaultTableModel DSMuon =
            (DefaultTableModel) this.TraSach_tbDSTra.getModel();
        DSMuon.removeRow(select);
    }//GEN-LAST:event_jButton4ActionPerformed

    /**
     * @param args the command line arguments
     */
    public static void main(String args[]) {
        /* Set the Nimbus look and feel */
        //<editor-fold defaultstate="collapsed" desc=" Look and feel setting code (optional) ">
        /* If Nimbus (introduced in Java SE 6) is not available, stay with the default look and feel.
         * For details see http://download.oracle.com/javase/tutorial/uiswing/lookandfeel/plaf.html 
         */
        try {
            for (javax.swing.UIManager.LookAndFeelInfo info : javax.swing.UIManager.getInstalledLookAndFeels()) {
                if ("Nimbus".equals(info.getName())) {
                    javax.swing.UIManager.setLookAndFeel(info.getClassName());
                    break;
                }
            }
        } catch (ClassNotFoundException ex) {
            java.util.logging.Logger.getLogger(Manager.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        } catch (InstantiationException ex) {
            java.util.logging.Logger.getLogger(Manager.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        } catch (IllegalAccessException ex) {
            java.util.logging.Logger.getLogger(Manager.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        } catch (javax.swing.UnsupportedLookAndFeelException ex) {
            java.util.logging.Logger.getLogger(Manager.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        }
        //</editor-fold>

        /* Create and display the form */
        java.awt.EventQueue.invokeLater(new Runnable() {
            public void run() {
                new Manager().setVisible(true);
            }
        });
    }

    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JPanel BanDoc;
    private javax.swing.JButton BanDoc_btSua;
    private javax.swing.JButton BanDoc_btThem;
    private javax.swing.JButton BanDoc_btXacNhan;
    private javax.swing.JButton BanDoc_btXoa;
    private javax.swing.JLabel BanDoc_lbMa;
    private javax.swing.JLabel BanDoc_lbSDT;
    private javax.swing.JLabel BanDoc_lbTenBanDoc;
    private javax.swing.JTable BanDoc_tbBanDoc;
    private javax.swing.JTextField BanDoc_txtMa;
    private javax.swing.JTextField BanDoc_txtSDT;
    private javax.swing.JTextField BanDoc_txtTenBanDoc;
    private javax.swing.JButton Info_LogOut;
    private javax.swing.JLabel Info_lbTK;
    private javax.swing.JTextField Info_tstTen;
    private javax.swing.JTextField Info_txtSDT;
    private javax.swing.JTextField Info_txtUsername;
    private javax.swing.JPanel Muon;
    private javax.swing.JButton Muon_HuyMuon;
    private javax.swing.JButton Muon_bt;
    private javax.swing.JButton Muon_btConfimrMuon;
    private javax.swing.JButton Muon_btTimKiemSach;
    private javax.swing.JButton Muon_btXacNhan;
    private javax.swing.JComboBox<String> Muon_cbTimTheo;
    private javax.swing.JLabel Muon_lbDSMuon;
    private javax.swing.JLabel Muon_lbMaKH;
    private javax.swing.JLabel Muon_lbMaSachTimKiem;
    private javax.swing.JLabel Muon_lbSLMuon;
    private javax.swing.JLabel Muon_lbSach;
    private javax.swing.JLabel Muon_lbTenKH;
    private javax.swing.JLabel Muon_lbTenSach;
    private javax.swing.JLabel Muon_lbTenSachTimKiem;
    private javax.swing.JLabel Muon_lbTenSachTimKiem1;
    private javax.swing.JLabel Muon_lbTheLoaiTimKiem;
    private javax.swing.JTable Muon_tbDSMuon;
    private javax.swing.JTable Muon_tbSach;
    private javax.swing.JTextField Muon_txtMaKH;
    private javax.swing.JTextField Muon_txtMaSachTimKiem;
    private javax.swing.JTextField Muon_txtSLMuon;
    private javax.swing.JTextField Muon_txtTenKH;
    private javax.swing.JTextField Muon_txtTenSach;
    private javax.swing.JTextField Muon_txtTenSachTimKiem;
    private javax.swing.JTextField Muon_txtTheLoaiTimKiem;
    private javax.swing.JPanel TimKiem;
    private javax.swing.JButton TimKiem_btHienThi;
    private javax.swing.JButton TimKiem_btMuon;
    private javax.swing.JButton TimKiem_btTim;
    private javax.swing.JComboBox<String> TimKiem_cbGet;
    private javax.swing.JLabel TimKiem_lbMaKH;
    private javax.swing.JLabel TimKiem_lbSDT;
    private javax.swing.JLabel TimKiem_lbTenKH;
    private javax.swing.JLabel TimKiem_lbTimTheo;
    private javax.swing.JTable TimKiem_tbDSKH;
    private javax.swing.JTextField TimKiem_txtMaKH;
    private javax.swing.JTextField TimKiem_txtSDT;
    private javax.swing.JTextField TimKiem_txtTenKH;
    private javax.swing.JPanel TraSach;
    private javax.swing.JButton TraSach_bt;
    private javax.swing.JButton TraSach_btHienThi;
    private javax.swing.JButton TraSach_btTimKiemSach;
    private javax.swing.JButton TraSach_btXacNhan;
    private javax.swing.JComboBox<String> TraSach_cbTimKiem;
    private javax.swing.JLabel TraSach_lbDSMuon;
    private javax.swing.JLabel TraSach_lbDSTra;
    private javax.swing.JLabel TraSach_lbMaKH;
    private javax.swing.JLabel TraSach_lbMaSach;
    private javax.swing.JLabel TraSach_lbSLTra;
    private javax.swing.JLabel TraSach_lbTenKH;
    private javax.swing.JLabel TraSach_lbTenSach;
    private javax.swing.JLabel TraSach_lbTheLoai;
    private javax.swing.JTable TraSach_tbDSMuon;
    private javax.swing.JTable TraSach_tbDSTra;
    private javax.swing.JTextField TraSach_txtMaKH;
    private javax.swing.JTextField TraSach_txtMaMuon;
    private javax.swing.JTextField TraSach_txtMaSachTimKiem;
    private javax.swing.JTextField TraSach_txtSLTra;
    private javax.swing.JTextField TraSach_txtTenKH;
    private javax.swing.JTextField TraSach_txtTenSachTimKiem;
    private javax.swing.JTextField TraSach_txtTheLoaiTimKiem;
    private javax.swing.JPanel TruyVan;
    private javax.swing.JButton TruyVan_bt;
    private javax.swing.JButton TruyVan_lbLayTT;
    private javax.swing.JButton TruyVan_lbQuaHan;
    private javax.swing.JTable TruyVan_tbDonMuon;
    private javax.swing.JLabel info_lbSDT;
    private javax.swing.JLabel info_lbTen;
    private javax.swing.JButton jButton1;
    private javax.swing.JButton jButton2;
    private javax.swing.JButton jButton3;
    private javax.swing.JButton jButton4;
    private javax.swing.JButton jButton5;
    private javax.swing.JPanel jPanel1;
    private javax.swing.JPanel jPanel3;
    private javax.swing.JScrollPane jScrollPane1;
    private javax.swing.JScrollPane jScrollPane2;
    private javax.swing.JScrollPane jScrollPane3;
    private javax.swing.JScrollPane jScrollPane4;
    private javax.swing.JScrollPane jScrollPane5;
    private javax.swing.JScrollPane jScrollPane6;
    private javax.swing.JScrollPane jScrollPane7;
    private javax.swing.JTabbedPane jTabbedPane1;
    // End of variables declaration//GEN-END:variables
}
